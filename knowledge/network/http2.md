## HTTP/2 有什么新特性
### 改进：
* 基于 Stream 机制的并发传输，多个请求共享一个连接。
* 支持 HTTPS。
* 头部压缩，采用 HPACK 算法，减少了请求头的大小。
* 二进制帧，分为头信息帧和数据帧，提高数据传输效率。
* 服务器主动推送。
### 瓶颈（主要来自 TCP 协议）：
* TCP 队头阻塞
* 连接迁移开销大

## 头部压缩
### HTTP/1.1 存在的问题
* 可以通过 Content-Encoding 来压缩响应体，但是请求头却无法压缩。
* 请求头中有很多重复的信息，比如 User-Agent、Cookie 等。
* 请求头采用文本形式传输，效率不如二进制编码。
### HPACK 算法
* 静态编码：使用静态索引表，存储常见的请求头，比如 GET、POST 等。
* 动态编码：除了静态索引表，客户端和服务端都会动态维护一张字典，用长度较小的索引号来表示请求头。
* 哈夫曼编码：对于一些常见的请求头，采用哈夫曼编码（官方统计得到，是不变的）来压缩。

<img src="/knowledge/assets/network/http2-hpack.png" width="750">

- 由于使用二进制编码，就不需要 \r\n 来分隔请求头了，而是使用上图的长度来表示每个字段的大小。

## 二进制帧
* HTTP/2 采用二进制帧来传输数据，分为数据帧和控制帧。
* 帧的头部包括帧长度、帧类型、流标识符等，接收方可以根据流标识符来区分不同的请求。
* 帧的数据部分包括请求头和请求体，请求头采用 HPACK 算法压缩。

<img src="/knowledge/assets/network/http2-frame.png" width="750">

## Stream
* Stream 是一个全双工的数据流，可以在一个 TCP 连接上同时传输多个 Stream。
* 不同的请求会被分配到不同的 Stream 上，客户端发起的请求是奇数，服务端发起的请求是偶数。
* 不同 Stream 的帧可以乱序发送，但同一个 Stream 的帧必须按顺序发送。