## Seata
Seata 是一款开源的分布式事务解决方案，主要特点是**无侵入性和高性能**，支持 AT、TCC、Saga 和 XA。

### Seata AT 模式
AT（Automatic Transaction）：自动事务模式，是基于 2PC 的增强，通过代理 SQL 实现分布式事务。
* 注册全局事务，生成事务 ID。
* 执行本地事务，注册分支事务。
* 汇报分支事务执行状态。
* 收集分支事务执行状态，决定全局事务提交或回滚。
* 提交则删除 undo log。
* 回滚则看 undo log 中能否直接回滚，**不能回滚怎么办？**

<img src="/knowledge/assets/seata/seata-at.png" width="900">

#### 写隔离
* 本地事务提交前需要先获取全局事务锁。
* 如果尝试多次获取全局事务锁失败，则会回滚本地事务，释放本地锁。
* 在数据库本地隔离级别在读提交及以上的基础上，Seata AT 默认为读未提交。
#### AT 与 XA 的区别
* AT：第一阶段就提交了事务，释放锁很快。
* XA：第一阶段只是询问，第二阶段才提交，释放锁慢。

## 如何解决分布式事务的问题？
### 强一致性场景
Seata AT 模式适用于订单支付、库存扣减等强一致性场景。
* 订单库：增加订单
* 商品库：减少库存
* 优惠劵库：减少优惠劵

### 弱一致性场景
Seata TCC 模式适用于修改订单状态、支付状态等弱一致性场景。

### 最终一致性
MQ 事务消息可以保证最终一致性，适用于积分发放、优惠劵发放等最终一致性场景。